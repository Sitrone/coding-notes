## 定义
对同一个系统，使用同样的条件，一次请求和重复的多次请求对系统资源的影响是一致的，幂等性是分布式系统中的一个重要概念。

要做到幂等性，从接口设计上来说不设计任何非幂等的操作即可。

## 常见领域
电商，银行，互联网金融等对数据准确性要求很高的领域中，这一特性具有十分重要的地位。

## 常用思路
### MVCC
多版本控制，乐观锁的一种，CAS的一种用法。在数据更新时需要需要比较数据的版本号是否和系统中的版本号是否一致，一致则更新成功并将版本号加一。
每个版本只有一次更新的机会，更新失败需要重新获取版本号，再去比较更新。

### 去重表
利用db的唯一索引来确保数据一旦插入成功则无法再次插入，典型的createOrUpdate思路


### 唯一ID机制
为每次操作生成唯一的token，一个token在操作的每一个阶段只有一次执行权，一旦执行成功则保存执行结果。对重复的请求，返回同一个结果。
以电商系统的订单为例，当用户下单时，会经历多个环节，比如生成订单，减库存，减优惠券等等。每一个环节执行时都先检测一下该订单id是否已经执行过这一步骤，对未执行的请求，执行操作并缓存结果，而对已经执行过的id，则直接返回之前的执行结果，不做任何操作。这样可以在最大程度上避免操作的重复执行问题，缓存起来的执行结果也能用于事务的控制等。


### 参考
1. [分布式高并发系统如何保证对外接口的幂等性？](https://www.zhihu.com/question/27744795  )
2. [幂等性浅谈](https://www.jianshu.com/p/475589f5cd7b)
3. [分布式系统互斥性与幂等性问题的分析与解决](https://zhuanlan.zhihu.com/p/22820761)
4. [Idempotency Patterns](http://blog.jonathanoliver.com/idempotency-patterns/)
