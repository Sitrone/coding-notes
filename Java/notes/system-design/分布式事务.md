### 分布式事务 

#### `2PC`二阶段提交

所谓的两个阶段是指：第一阶段：**准备阶段(投票阶段)**和第二阶段：**提交阶段（执行阶段）**

* **投票阶段**（voting phase）：参与者通知协调者，协调者反馈结果；
* **提交阶段**（commit phase）：收到参与者的反馈后，协调者再向参与者发出通知，根据反馈情况决定各参与者是否要提交还是回滚

**缺陷**：

1. **单点故障**，协调者只有一个，一旦发生故障，会一直阻塞下去，尤其在第二阶段，协调者发生故障，那么所有的参与者还都处于锁定事务资源的状态中，而无法继续完成事务操作
2. **同步阻塞**，所有参与的节点都是事务阻塞型的
3. **数据不一致**，在第二阶段协调者向各个参与者发送commit的请求之后，如果发生了局部网络异常或者协调者发生了故障，这会导致只有一部分参与者接受到了commit请求。但是其他部分未接到commit请求的机器则无法执行事务提交。于是整个分布式系统便出现了数据部一致性的现象



#### `3PC`三阶段提交

由于`2PC`存在着上面说的诸多问题，出现了改进版本`3PC`

* **`CanCommit`阶段**：协调者向参与者发送commit请求，参与者如果可以提交就返回Yes响应，否则返回No响应
* **`PreCommit`阶段**：
  * 假如协调者从所有的参与者获得的反馈都是`Yes`响应，那么就会执行事务的预执行
  * 假如有任何一个参与者向协调者发送了`No`响应，或者等待超时之后，协调者都没有接到参与者的响应，那么就执行事务的中断
* **`DoCommit`阶段**：执行提交或者中断事务



```
在doCommit阶段，如果参与者无法及时接收到来自协调者的doCommit或者rebort请求时，会在等待超时之后，会继续进行事务的提交。
```

**缺陷**：

>  3PC主要解决的单点故障问题，并减少阻塞，因为一旦参与者无法及时收到来自协调者的信息之后，他会默认执行commit。而不会一直持有事务资源并处于阻塞状态。但是这种机制也会导致数据一致性问题，因为，由于网络原因，协调者发送的abort响应没有及时被参与者接收到，那么参与者在等待超时之后执行了commit操作。这样就和其他接到abort命令并执行回滚的参与者之间存在数据不一致的情况

#### `TCC`





#### 共识算法

* paxos





* Raft





### 参考 

1. [分布式基础，啥是两阶段提交？](https://blog.csdn.net/z50l2o08e2u4aftor9a/article/details/83422728) 
2. [分布式事务，原来可以这么玩？](https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&mid=2651961647&idx=1&sn=8421c1da08730c47710530f976c1909d&chksm=bd2d0cf38a5a85e52f4fe48b521fbfed9c4d5cee9fcf02f4d9958ed515c88659cfee3130f67c&scene=21#wechat_redirect) 
3. [关于分布式事务、两阶段提交协议、三阶提交协议](https://www.hollischuang.com/archives/681)
4. 